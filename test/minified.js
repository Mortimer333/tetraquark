class a{I; b=__k;c=[];d=false;e=false;f='\u00A0';N; g={ê:false,õ:false,ú:false};h={A:null,B:null,C:null};i={D:false,E:false,t:false,F:false,G:{B:-1,  A:-1,  _N:-1,},H:{B:-1,  A:-1,  _N:-1,}};j=2;constructor(I,O={}){if(typeof I?.nodeType=='undefined')throw new Error('You can\'t create Editor JF without passing node to set as editor.');if(I.nodeType!=1)throw new Error('Editor node has to be of proper node type. [1]');this.I=I;this.I.setAttribute('tabindex', '-1');this.I.classList.add('tabjf_editor');const P={Q:__k,B:__s,R:false,S:false,T:false};Object.__j(P).forEach(U=>{O[U]=typeof O[U]=='undefined'?P[U]:O[U];});this.J=O;this.J.K=this.I.offsetHeight;this.k();this._save.L=this._hidden.L(this._save.publish, 500);this.D.M=this._hidden.L(this.D.resize, 500);const V=[['remove','selected'],['remove','one'],['remove','word'],['action','paste'],['newLine'],['mergeLine'],['insert']];V.forEach(W=>{this.O.preciseMethodsProxy(this, W);});this.o();this.caret.C=this.caret.create(this.I);this.caret.hide();this.font.createLab();this.render.init(this.J.T, this.J.S);this.action.createCopyGround();if(this.J.R)this.R.init();this.truck.import(this.render.__X, this.render.linesLimit);this.m();this.O.docEvents();this.N=this.D.select.bind?this.D.select.bind(this):this.D.select;}k(){const X=[{Y:TabJF_Hidden,Z:'_hidden'},{Y:TabJF_Save,Z:'_save',Ī:[{Y:TabJF_Save_Set,Z:'set'},{Y:TabJF_Save_Content,Z:'content'}]},{Y:TabJF_Action,Z:'action'},{Y:TabJF_Caret,Z:'caret'},{Y:TabJF_Clear,Z:'clear'},{Y:TabJF_End,Z:'end'},{Y:TabJF_Event,Z:'event'},{Y:TabJF_Font,Z:'font'},{Y:TabJF_Get,Z:'get'},{Y:TabJF_Is,Z:'is',Ī:[{Y:TabJF_Is_Line,Z:'line'}]},{Y:TabJF_Keys,Z:'keys'},{Y:TabJF_Remove,Z:'remove'},{Y:TabJF_Render,Z:'render',Ī:[{Y:TabJF_Render_Fill,Z:'fill'},{Y:TabJF_Render_Move,Z:'move'},{Y:TabJF_Render_Add,Z:'add'},{Y:TabJF_Render_Remove,Z:'remove'},{Y:TabJF_Render_Set,Z:'set'},{Y:TabJF_Render_Update,Z:'update'}]},{Y:TabJF_Replace,Z:'replace'},{Y:TabJF_Set,Z:'set'},{Y:TabJF_Syntax,Z:'syntax',Ī:[{Y:TabJF_Syntax_Create,Z:'create'}]},{Y:TabJF_Truck,Z:'truck'},{Y:TabJF_Update,Z:'update',Ī:[{Y:TabJF_Update_Selection,Z:'selection'}]}];X.forEach($=>{this.l($);});}l($,_=this){const _a=$.Z;if(!_[_a]){_[_a]={};}const _b=$.Y;const _c=Object.getOwnPropertyNames(_b.prototype);const Y=new classInstance.prototype.constructor;if(!Y._d){Y._d=_b._f.replace(this.constructor._f+'_', '').replaceAll('_', '.').toLowerCase();}const _e=Object.getOwnPropertyNames(Y);_c.forEach(_f=>{if(_f!='constructor'){_[_a][_f];_g=_b.prototype[_f].bind(this);};});_e.forEach(_f=>{_[_a][_f];_g=Y[_f];});if($?.Ī){$.Ī.forEach(_h=>{this.l(_h, this[_a]);});};}m(){if(a.prototype._i)return;var _j=document.createElement('style');_j.setAttribute('name', "TabJF Styles");document.head.insertBefore(_j, document.head.children[__k]);const _k=_j.sheet;styles.forEach(_l=>{_k.insertRule(_l, _k.cssRules.length);});a.prototype._i=true;}n={_m:this,_n:function(_p,_r,_s){const _m=this._m;const _t=_m._save;const _f=_p._f.replace('bound ', '');_t.L();const _u=_t._o;_t._o=true;const _w=_t._G.length;_t._q.push(_f);let _z=_m.h.B;const _y=_m.get.i();if(_y._O.toLowerCase()=='range'){_z=_m.i.G.B;if(_m.i.G.B>_m.i.H.B){_z=_m.i.H.B;}}_t.O.add(_f, _s);const _x=_p.bind(_m)(..._s);_t.O.remove(_f, _s, _w, _z);if(!_u){_t._q=[];_t._o=false;_t.moveToPending();}return _x;}};o(){this.I.addEventListener("mousedown", this.t.bind?this.t.bind(this):this.t);this.I.addEventListener("mouseup", this.r.bind?this.r.bind(this):this.r);this.I.addEventListener("focusout", this.w.bind?this.w.bind(this):this.w);this.I.addEventListener("dblclick", this.p.bind?this.p.bind(this):this.p);}p(_v){this.D.select();this.D.i.G(__k, this.i.H.B, this.i.H._N);this.s();}r(_v){this.I.removeEventListener('mousemove', this.N, true);if(this.get.i()._O=='Range'){const _µ=this._µ.dispatch('tabJFSelectStop',{h:this.get.clonedPos(),_µ:_v,i:this.get.clone(this.i)});if(_µ.defaultPrevented)return;}this.i.D=false;this.s();}s(){if(!this.i.t)return;const G=this.i.G;const H=this.i.H;let _ú=false;if(G.B<this.render.hidden&&H.B<this.render.hidden)return;let _A=H.B;let _B=H._N;let _C=G._N;let _D,_E,_F;if(_A<G.B||_A==G.B&&_B<_C||_A==G.B&&_B==_C&&H.A<G.A){_ú=true;_E=H.A;_F=G.A;_D=_A;_A=G.B;const _G=_C;_C=_B;_B=_G;}else{_E=G.A;_F=H.A;_D=G.B;}if(_D<this.render.hidden||(this.i.D&&_D>=this.render.hidden+this.render.linesLimit)){_D=this.render.hidden;_E=__k;_C=__k;_F=H.A;}if(_F<__k){return;}if(_A>=this.render.hidden+this.render.linesLimit){_A=this.render.hidden+this.render.linesLimit-1;let _H=this.get.lineByPos(_A);let _I=_H.children[_H.children.length-1];_B=_I.childNodes.length-1;_F=_I.childNodes[_I.childNodes.length-1].nodeValue.length;}let _ê=this.get.lineByPos(_D);let _õ=this.get.lineByPos(_A);if(!_ê||!_õ){return;}_ê=_ê.children[_C].childNodes[__k];_õ=_õ.children[_B].childNodes[__k];const _J=new Range;const _K=_ê.nodeValue.length;const _L=_õ.nodeValue.length;if(_K<_E)_E=_K;if(_L<_F)_F=_L;_J.setStart(_ê, _E);_J.setEnd(_õ, _F);this.get.i().removeAllRanges();this.get.i().addRange(_J);}t(_v){const _µ=this._µ.dispatch('tabJFActivate',{h:this.get.clonedPos(),_µ:_v});if(_µ.defaultPrevented)return;if(_v._p==this.I||_v.__J<__k||_v.__K<__k)return;let C=_v._p;if(C.nodeName==="P")C=C.children[C.children.length-1];const B=C.parentElement.offsetTop/this.J.B;const A=this.font.getLetterByWidth(C.innerText, C, _v.clientX-C.offsetLeft-this.J.Q);this.caret.show();const _M=this.get.childIndex(C);this.caret.refocus(A,  B,  _M,);if(B<this.render.hidden+2&&this.render.hidden>__k){this.render.O.overflow(null,(B-2)*this.J.B);}else if(B>this.render.hidden+this.render.linesLimit-5){this.render.O.overflow(null,(B-(this.render.linesLimit-5))*this.J.B);}this.b=this.get.realPos().__J;this.i.G={B:B,A,_N:_M};this.i.H={B:-1,A:-1,_N:-1};this.i.t=false;this.I.addEventListener('mousemove', this.N,  true);this.e=true;this.u();}u(){this.g.õ=false;this.g.ê=false;this.g.ú=false;}w(_v){const _µ=this._µ.dispatch('tabJFDeactivate',{h:this.get.clonedPos(),_µ:_v});if(_µ.defaultPrevented)return;this.caret.hide();this.d=false;this.e=false;}z(_v){if(!this._v)return;const _O=_v._O;if(_O=='keydown'){const _µ=this._µ.dispatch('tabJFKeyDown',{h:this.get.clonedPos(),_µ:_v});if(_µ.defaultPrevented)return;}else if(_O=='keyup'){const _µ=this._µ.dispatch('tabJFKeyUp',{h:this.get.clonedPos(),_µ:_v});if(_µ.defaultPrevented)return;}this.D.specialKeys(_v);if(_O=='keyup')return;const _P={_Q:true,_R:true,_S:true,_T:true,_U:true,_V:true,_W:true,_X:true,_Y:true};const _Z={_Ī:true,_$:true,__:true,__a:true,__b:true,__c:true,__d:true,__e:true,__f:true,__g:true,__h:true,__i:true};if(_Z[_v.keyCode])return;if(_P[_v.keyCode])_v.preventDefault();const __j={__k:(_v,_O)=>{},__l:(_v,_O)=>{this.__j.__N(_v);},__m:(_v,_O)=>{this.__j.tab(_v);},__n:(_v,_O)=>{this.__j.enter(_v);},__o:(_v,_O)=>{const i=this.get.i();if(i._O=='Caret'){this.D.i.G();};},__p:(_v,_O)=>{},__r:(_v,_O)=>{},__s:(_v,_O)=>{},__t:(_v,_O)=>{this.__j.__O(_v);},__u:(_v,_O)=>{_v.preventDefault();this.__j.space(_v);},_Q:(_v,_O)=>{this.y(-1,-1);},_R:(_v,_O)=>{this.y(1, 1);},_S:(_v,_O)=>{this.y(1, __k);},_T:(_v,_O)=>{this.y(-1, __k);},__w:(_v,_O)=>{this.__j.__M(_v);},_U:(_v,_O)=>{const _µ=this._µ.dispatch('tabJFMove',{h:this.get.clonedPos(),_µ:_v,i:this.get.clone(this.i),__J:-1,__K:__k});if(_µ.defaultPrevented)return;this.__j.move(-1, __k);},_V:(_v,_O)=>{const _µ=this._µ.dispatch('tabJFMove',{h:this.get.clonedPos(),_µ:_v,i:this.get.clone(this.i),__J:__k,__K:-1});if(_µ.defaultPrevented)return;this.__j.move(__k,-1);},_W:(_v,_O)=>{const _µ=this._µ.dispatch('tabJFMove',{h:this.get.clonedPos(),_µ:_v,i:this.get.clone(this.i),__J:1,__K:__k});if(_µ.defaultPrevented)return;this.__j.move(1, __k);},_X:(_v,_O)=>{const _µ=this._µ.dispatch('tabJFMove',{h:this.get.clonedPos(),_µ:_v,i:this.get.clone(this.i),__J:__k,__K:1});if(_µ.defaultPrevented)return;this.__j.move(__k, 1);},__z:(_v,_O)=>{},__y:(_v,_O)=>{if(this.g.õ){_v.preventDefault();this.action.selectAll();}else{this.v(_v.z);};},__x:(_v,_O)=>{if(this.g.õ){this.action.copy();}else{this.v(_v.z);};},__q:(_v,_O)=>{if(!this.g.õ){this.v(_v.z);};},__v:(_v,_O)=>{if(this.g.õ){this.action.cut();}else{this.v(_v.z);};},__µ:(_v,_O)=>{if(this.g.õ){this.action.redo();}else{this.v(_v.z);};},__ê:(_v,_O)=>{if(this.g.õ){this.action.undo();}else{this.v(_v.z);};},__õ:(_v,_O)=>{},__ú:(_v,_O)=>{this.v('*');},__A:(_v,_O)=>{this.v('-');},__B:(_v,_O)=>{_v.preventDefault();this.v('/');},__C:(_v,_O)=>{},__D:(_v,_O)=>{},__E:(_v,_O)=>{},__F:(_v,_O)=>{},__G:(_v,_O)=>{_v.preventDefault();if(this.g.ê){this.v('?');}else{this.v('/');};},__H:(_v,_O)=>{if(this.g.ê)this.v('~');else this.v('`');},__I:(_v,_O)=>{throw new Error('Unknow special key',_v.keyCode);}};const __L={__M:true,__N:true,__O:true};const _y=this.get.i();const __P={__H:z=>{return this.g.ê?'~':'`';},__I:z=>z};const z=(__P[_v.keyCode]||__P['default'])(_v.z);if(this.i.t&&!__L[z.toLowerCase()]&&!this.g.õ&&_y._O=="Range"&&(!!this.__j[z.toLowerCase()]||z.length==1)){this.remove.selected();}if(!__j[_v.keyCode]&&z.length==1){this.v(z);}else{(__j[_v.keyCode]||__j['default'])(_v, _O);}const __Q={__o:true,__p:true,__r:true,__s:true};if(!__Q[_v.keyCode]&&!this.caret.isVisible()){this.render.O.overflow(null,(this.h.B-(this.render.linesLimit/2))*this.J.B);}const __R={__q:()=>{if(!this.g.õ)return false;return true;},__x:()=>true,__I:()=>false};if(!(__R[_v.keyCode]||__R['default'])()){this.D.page();this.render.D.scrollWidthWithCurrentLine();if(!__Q[_v.keyCode]){this.caret.scrollToX();}};}y(__S,__T){let B=this.h.B;let A=this.h.A;let _N=this.h.childIndex;if(__T>__k){B=this.render.__X.length-1;}else if(__T<__k){B=__k;}if(__S>__k){let __U=this.render.__X[B];_N=__U.__X.length-1;let __V=__U.__X[__U.__X.length-1];A=this.replace.spaceChars(__V.__X).length;}else if(__S<__k){A=__k;_N=__k;}const __W=this.render.__X[B];if(__W.__X.length-1<_N){_N=__W.__X.length-1;}if(this.replace.spaceChars(__W.__X[_N].__X).length<A){A=this.replace.spaceChars(__W.__X[_N].__X).length;}this.caret.refocus(A,  B,  _N);this.b=this.get.realPos().__J;}x(){let C=this.h.C,__Y=this.get.splitRow();if(__Y.___b.innerText.length>__k){C.parentElement.insertBefore(__Y.___b, C);C.remove();C=__Y.___b;}else{C.__Z='';C.appendChild(document.createTextNode(''));}this.render.__X[this.h.B].__X=this.truck.exportLine(C.parentElement).__X;let x=document.createElement("p");let __Ī=[];__Y.___c.forEach(__$=>{if(__$.innerText.length>__k){x.appendChild(__$);__Ī.push(__$);};});if(__Ī.length==__k){__Y.___c[__k].appendChild(document.createTextNode(''));x.appendChild(__Y.___c[__k]);__Ī.push(__Y.___c[__k]);}this.render.__X.splice(this.h.B+1,  __k, this.truck.exportLine(x));if(this.h.B+1>this.render.hidden+this.render.linesLimit-6){this.render.O.overflow(null,(this.h.B-(this.render.linesLimit-6))*this.J.B);this.render.move.page({___:this.h.B-(this.render.linesLimit-6)});}else{this.render.move.page();}this.caret.refocus(__k, this.h.B+1, __k);this.b=__k;this.render.D.minHeight();this.render.D.scrollWidth();}q(___a){let B=this.get.B(this.h.C);if(B.nodeName!="P")throw new Error("Parent has wrong tag, can't merge lines");if(___a<__k){this.h.B--;this.y(1, __k);this.render.__X[this.h.B].__X=this.render.__X[this.h.B].__X.concat(this.render.__X[this.h.B+1].__X);this.render.__X.splice(this.h.B+1, 1);this.b=this.get.realPos().__J;}else if(___a>__k){this.render.__X[this.h.B].__X=this.render.__X[this.h.B].__X.concat(this.render.__X[this.h.B+1].__X);this.render.__X.splice(this.h.B+1, 1);}this.render.D.minHeight();this.render.D.scrollWidth();}v(z){let __Y=this.replace.spaceChars(this.render.__X[this.h.B].__X[this.h.childIndex].__X);__Y={___b:__Y.substr(__k, this.h.A),___c:__Y.substr(this.h.A)};__Y=this.replace.spaces(__Y.___b)+z+this.replace.spaces(__Y.___c);this.render.__X[this.h.B].__X[this.h.childIndex].__X=__Y;this.caret.refocus(this.h.A+this.replace.spaceChars(z).length);this.b=this.get.realPos().__J;}µ(_v){if(!this._v){return;}if(!this.d){let ___d=(_µ.clipboardData||window.clipboardData).getData('text');this.c=this.truck.exportText(___d);}this.action.___d();}}export{a};
